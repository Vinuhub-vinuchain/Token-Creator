<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VinuToken Creator</title>
  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Open Sans', sans-serif;
    }

    body {
      background: #000000;
      color: #FFFFFF;
      line-height: 1.6;
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      width: 100%;
      height: 60px;
      background: #000000;
      border-bottom: 1px solid #FFFFFF;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .logo img {
      height: 40px;
      width: auto;
    }

    .wallet-section {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .wallet-btn {
      background: #FFFFFF;
      color: #000000;
      border: 1px solid #FFFFFF;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
    }

    .wallet-btn:hover:not(:disabled) {
      background: #000000;
      color: #FFFFFF;
    }

    .wallet-btn:disabled {
      background: #404040;
      cursor: not-allowed;
    }

    .balance {
      font-size: 14px;
      color: #A0A0A0;
    }

    /* Main Content */
    .container {
      max-width: 800px;
      margin: 80px auto 20px;
      padding: 20px;
      background: #000000;
      border: 1px solid #FFFFFF;
      border-radius: 8px;
    }

    h2 {
      font-family: 'Montserrat', sans-serif;
      font-size: 24px;
      color: #FFFFFF;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      color: #FFFFFF;
      margin-bottom: 5px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #FFFFFF;
      border-radius: 4px;
      background: #000000;
      color: #FFFFFF;
      font-size: 16px;
    }

    input:focus, select:focus {
      border: 2px solid #FFFFFF;
      outline: none;
    }

    input::placeholder {
      color: #A0A0A0;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
      margin-right: 10px;
    }

    .slider-group {
      display: flex;
      flex-direction: column;
    }

    .slider-value {
      font-size: 14px;
      color: #A0A0A0;
      margin-top: 5px;
    }

    .preview {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #FFFFFF;
      border-radius: 8px;
      background: #000000;
      box-shadow: 0 2px 4px #404040;
    }

    .preview p {
      font-size: 16px;
      color: #FFFFFF;
    }

    .deploy-btn {
      background: #FFFFFF;
      color: #000000;
      border: 1px solid #FFFFFF;
      border-radius: 8px;
      padding: 12px 24px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }

    .deploy-btn:hover:not(:disabled) {
      background: #000000;
      color: #FFFFFF;
    }

    .deploy-btn:disabled {
      background: #404040;
      cursor: not-allowed;
    }

    .loading {
      display: none;
      margin-left: 10px;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #FFFFFF;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      color: #FF0000;
      font-size: 12px;
      margin-top: 5px;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      border-top: 1px solid #FFFFFF;
      background: #000000;
      font-size: 14px;
      color: #FFFFFF;
    }

    footer a {
      color: #FFFFFF;
      text-decoration: none;
      margin: 0 10px;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        height: auto;
        padding: 10px;
      }

      .logo img {
        height: 30px;
      }

      .wallet-section {
        flex-direction: column;
        width: 100%;
      }

      .wallet-btn {
        width: 100%;
        text-align: center;
      }

      .container {
        margin: 120px 10px 20px;
        padding: 15px;
      }

      h2 {
        font-size: 20px;
      }

      input, select {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="https://photos.pinksale.finance/file/pinksale-logo-upload/1759847695513-f915ce15471ce09f03d8fbf68bc0616f.png" alt="VinuToken Creator Logo">
    </div>
    <div class="wallet-section">
      <button class="wallet-btn" id="walletBtn">Connect Wallet</button>
      <div class="balance" id="balance">Balance: 0 VC</div>
    </div>
  </header>

  <div class="container">
    <h2>Create Your Token on VinuChain</h2>
    <!-- Basic Details -->
    <div class="form-group">
      <label for="tokenName">Token Name</label>
      <input type="text" id="tokenName" placeholder="e.g., MyToken" maxlength="32">
      <div class="error" id="nameError"></div>
    </div>
    <div class="form-group">
      <label for="tokenSymbol">Symbol</label>
      <input type="text" id="tokenSymbol" placeholder="e.g., MTK" maxlength="6">
      <div class="error" id="symbolError"></div>
    </div>
    <div class="form-group">
      <label for="totalSupply">Total Supply</label>
      <input type="number" id="totalSupply" placeholder="e.g., 1000000000" min="1">
      <div class="error" id="supplyError"></div>
    </div>
    <div class="form-group">
      <label for="decimals">Decimals</label>
      <select id="decimals">
        <option value="6">6</option>
        <option value="9">9</option>
        <option value="12">12</option>
        <option value="18" selected>18</option>
      </select>
    </div>

    <!-- Advanced Options -->
    <h2>Advanced Options</h2>
    <div class="form-group slider-group">
      <label for="buyTaxRate">Buy Tax (%)</label>
      <input type="range" id="buyTaxRate" min="0" max="10" step="0.1" value="0">
      <span class="slider-value" id="buyTaxValue">0%</span>
    </div>
    <div class="form-group slider-group">
      <label for="sellTaxRate">Sell Tax (%)</label>
      <input type="range" id="sellTaxRate" min="0" max="10" step="0.1" value="0">
      <span class="slider-value" id="sellTaxValue">0%</span>
    </div>
    <div class="form-group slider-group">
      <label for="burnRate">Auto-Burn Rate (% per tx)</label>
      <input type="range" id="burnRate" min="0" max="5" step="0.1" value="0">
      <span class="slider-value" id="burnValue">0%</span>
    </div>
    <div class="form-group">
      <label for="devWallet">Dev Wallet Address</label>
      <input type="text" id="devWallet" placeholder="e.g., 0x1234...">
      <div class="error" id="devWalletError"></div>
    </div>
    <div class="form-group">
      <label for="maxTx">Max Transaction Amount (% of supply)</label>
      <input type="number" id="maxTx" placeholder="e.g., 1" min="0" max="100">
      <div class="error" id="maxTxError"></div>
    </div>
    <div class="form-group checkbox-group">
      <input type="checkbox" id="renounceOwnership">
      <label for="renounceOwnership">Renounce Ownership After Deployment</label>
    </div>

    <!-- Preview -->
    <div class="preview" id="preview">
      <p>Token: <span id="previewName">MyToken</span> (<span id="previewSymbol">MTK</span>)</p>
      <p>Supply: <span id="previewSupply">1,000,000,000</span></p>
      <p>Decimals: <span id="previewDecimals">18</span></p>
      <p>Buy Tax: <span id="previewBuyTax">0%</span></p>
      <p>Sell Tax: <span id="previewSellTax">0%</span></p>
      <p>Burn Rate: <span id="previewBurn">0%</span></p>
      <p>Dev Wallet: <span id="previewDevWallet">Not set</span></p>
      <p>Max Tx: <span id="previewMaxTx">None</span></p>
      <p>Renounce Ownership: <span id="previewRenounce">No</span></p>
    </div>

    <button class="deploy-btn" id="deployBtn" disabled>
      Deploy Token <span class="loading" id="loading"></span>
    </button>
  </div>

  <footer>
    <a href="https://vinuchain.org" target="_blank">VinuChain Docs</a> |
    <a href="https://vinuexplorer.org" target="_blank">Explorer</a> |
    <a href="#" target="_blank">Support</a>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // Wallet Connection
    const walletBtn = document.getElementById('walletBtn');
    const deployBtn = document.getElementById('deployBtn');
    const balanceEl = document.getElementById('balance');
    const loading = document.getElementById('loading');
    let provider;
    let signer;

    async function connectWallet() {
      if (!window.ethereum) {
        alert('Please install MetaMask or another Ethereum-compatible wallet.');
        return;
      }

      walletBtn.disabled = true;
      walletBtn.innerHTML = 'Connecting... <span class="loading"></span>';

      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send('eth_requestAccounts', []);
        const network = await provider.getNetwork();

        if (network.chainId !== 207) {
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0xCF' }],
            });
          } catch (switchError) {
            if (switchError.code === 4902) {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: '0xCF',
                  chainName: 'VinuChain',
                  rpcUrls: ['https://rpc.vinuchain.org', 'https://vinuchain-rpc.com'],
                  nativeCurrency: { name: 'VinuChain', symbol: 'VC', decimals: 18 },
                  blockExplorerUrls: ['https://vinuexplorer.org']
                }],
              });
            } else {
              throw switchError;
            }
          }
        }

        signer = provider.getSigner();
        const address = await signer.getAddress();
        const balance = await provider.getBalance(address);
        const balanceFormatted = ethers.utils.formatEther(balance) + ' VC';

        walletBtn.textContent = `Connected: ${address.slice(0, 6)}...${address.slice(-4)}`;
        balanceEl.textContent = `Balance: ${balanceFormatted}`;
        walletBtn.disabled = false;
        deployBtn.disabled = false;
      } catch (error) {
        console.error('Wallet connection failed:', error);
        alert('Failed to connect wallet. Please try again.');
        walletBtn.textContent = 'Connect Wallet';
        walletBtn.disabled = false;
      }
    }

    walletBtn.addEventListener('click', connectWallet);

    // Form Inputs
    const inputs = {
      name: document.getElementById('tokenName'),
      symbol: document.getElementById('tokenSymbol'),
      supply: document.getElementById('totalSupply'),
      decimals: document.getElementById('decimals'),
      buyTaxRate: document.getElementById('buyTaxRate'),
      sellTaxRate: document.getElementById('sellTaxRate'),
      burnRate: document.getElementById('burnRate'),
      devWallet: document.getElementById('devWallet'),
      maxTx: document.getElementById('maxTx'),
      renounceOwnership: document.getElementById('renounceOwnership'),
    };

    const previews = {
      name: document.getElementById('previewName'),
      symbol: document.getElementById('previewSymbol'),
      supply: document.getElementById('previewSupply'),
      decimals: document.getElementById('previewDecimals'),
      buyTax: document.getElementById('previewBuyTax'),
      sellTax: document.getElementById('previewSellTax'),
      burn: document.getElementById('previewBurn'),
      devWallet: document.getElementById('previewDevWallet'),
      maxTx: document.getElementById('previewMaxTx'),
      renounce: document.getElementById('previewRenounce'),
    };

    const buyTaxValue = document.getElementById('buyTaxValue');
    const sellTaxValue = document.getElementById('sellTaxValue');
    const burnValue = document.getElementById('burnValue');

    // Validation functions
    function validateForm() {
      let isValid = true;
      const errors = {
        name: document.getElementById('nameError'),
        symbol: document.getElementById('symbolError'),
        supply: document.getElementById('supplyError'),
        devWallet: document.getElementById('devWalletError'),
        maxTx: document.getElementById('maxTxError'),
      };

      // Clear previous errors
      Object.values(errors).forEach(el => el.textContent = '');

      if (!inputs.name.value.trim()) {
        errors.name.textContent = 'Token name is required.';
        isValid = false;
      }
      if (!inputs.symbol.value.trim()) {
        errors.symbol.textContent = 'Symbol is required.';
        isValid = false;
      }
      if (!inputs.supply.value || parseInt(inputs.supply.value) <= 0) {
        errors.supply.textContent = 'Supply must be greater than 0.';
        isValid = false;
      }
      if ((inputs.buyTaxRate.value > 0 || inputs.sellTaxRate.value > 0) && !ethers.utils.isAddress(inputs.devWallet.value)) {
        errors.devWallet.textContent = 'Valid dev wallet address required when taxes are set.';
        isValid = false;
      }
      if (inputs.maxTx.value && (parseInt(inputs.maxTx.value) < 0 || parseInt(inputs.maxTx.value) > 100)) {
        errors.maxTx.textContent = 'Max Tx must be between 0 and 100%.';
        isValid = false;
      }

      return isValid;
    }

    function updatePreview() {
      previews.name.textContent = inputs.name.value || 'MyToken';
      previews.symbol.textContent = inputs.symbol.value || 'MTK';
      previews.supply.textContent = inputs.supply.value ? Number(inputs.supply.value).toLocaleString() : '1,000,000,000';
      previews.decimals.textContent = inputs.decimals.value;
      previews.buyTax.textContent = `${inputs.buyTaxRate.value}%`;
      buyTaxValue.textContent = `${inputs.buyTaxRate.value}%`;
      previews.sellTax.textContent = `${inputs.sellTaxRate.value}%`;
      sellTaxValue.textContent = `${inputs.sellTaxRate.value}%`;
      previews.burn.textContent = `${inputs.burnRate.value}%`;
      burnValue.textContent = `${inputs.burnRate.value}%`;
      previews.devWallet.textContent = inputs.devWallet.value || 'Not set';
      previews.maxTx.textContent = inputs.maxTx.value ? `${inputs.maxTx.value}%` : 'None';
      previews.renounce.textContent = inputs.renounceOwnership.checked ? 'Yes' : 'No';
    }

    // Add event listeners
    Object.values(inputs).forEach(input => {
      if (input.type === 'checkbox' || input.type === 'range') {
        input.addEventListener('change', () => {
          updatePreview();
          validateForm();
        });
      } else {
        input.addEventListener('input', () => {
          updatePreview();
          validateForm();
        });
      }
    });

    updatePreview(); // Initial update

    // Deploy Function
    deployBtn.addEventListener('click', async () => {
      if (!signer) {
        alert('Please connect wallet first.');
        return;
      }

      if (!validateForm()) {
        alert('Please fix the form errors before deploying.');
        return;
      }

      const factoryAddress = '0x50a181Da07faf8656336247E88478a86EfB3F29A';
      const factoryABI = [
        'function createToken(string memory name, string memory symbol, uint256 initialSupply, uint8 decimals, uint256 buyTaxRate, uint256 sellTaxRate, uint256 burnRate, address devWallet, uint256 maxTxPercentage, bool renounce) external returns (address)',
        'event TokenCreated(address indexed tokenAddress, address indexed creator)'
      ];

      try {
        deployBtn.disabled = true;
        loading.style.display = 'inline-block';
        deployBtn.textContent = 'Deploying...';

        const factory = new ethers.Contract(factoryAddress, factoryABI, signer);

        const name = inputs.name.value.trim();
        const symbol = inputs.symbol.value.trim().toUpperCase();
        const supply = ethers.utils.parseUnits(inputs.supply.value, inputs.decimals.value);
        const decimals = parseInt(inputs.decimals.value);
        const buyTaxRate = parseInt(inputs.buyTaxRate.value * 100); // Basis points: 5% = 500
        const sellTaxRate = parseInt(inputs.sellTaxRate.value * 100);
        const burnRate = parseInt(inputs.burnRate.value * 100);
        const devWallet = inputs.devWallet.value || '0x0000000000000000000000000000000000000000'; // Default to zero if not set
        const maxTxPercentage = parseInt(inputs.maxTx.value || '0');
        const renounce = inputs.renounceOwnership.checked;

        const tx = await factory.createToken(name, symbol, supply, decimals, buyTaxRate, sellTaxRate, burnRate, devWallet, maxTxPercentage, renounce, { gasLimit: 3000000 });
        alert(`Transaction sent: ${tx.hash}. Waiting for confirmation...`);

        const receipt = await tx.wait();
        const event = receipt.events?.find(e => e.event === 'TokenCreated');
        const tokenAddress = event?.args?.tokenAddress;

        if (tokenAddress) {
          alert(`Token deployed successfully at: ${tokenAddress}\nView on Explorer: https://vinuexplorer.org/address/${tokenAddress}\nNote: After creating liquidity on VinuSwap, call setPair on the token contract with the pair address.`);
        } else {
          alert('Deployment successful, but could not parse token address. Check tx: https://vinuexplorer.org/tx/' + tx.hash);
        }
      } catch (error) {
        console.error('Deployment failed:', error);
        alert(`Deployment failed: ${error.message}`);
      } finally {
        deployBtn.disabled = false;
        loading.style.display = 'none';
        deployBtn.textContent = 'Deploy Token';
      }
    });
  </script>
</body>
</html>
